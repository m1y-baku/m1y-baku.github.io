<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M1Y | Money Power</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7504908879387895"
     crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getDatabase, ref, push, onValue, serverTimestamp, query as rQuery, limitToLast, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase tənzimləmələri (Olduğu kimi qalır)
        const firebaseConfig = {
            apiKey: "AIzaSyDkY51jHCvchXjlk0N005SaRcneCv_fWX0",
            authDomain: "timexbaku-a2c66.firebaseapp.com",
            projectId: "timexbaku-a2c66",
            storageBucket: "timexbaku-a2c66.firebasestorage.app",
            messagingSenderId: "837389958136",
            appId: "1:837389958136:web:6de36b6d6049783051f40d",
            databaseURL: "https://timexbaku-a2c66-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const rdb = getDatabase(app);

        // İstifadəçi ID və Premium yoxlaması
        if (!localStorage.getItem('m1y_user_id')) {
            localStorage.setItem('m1y_user_id', 'M1Y-' + Math.random().toString(36).substr(2, 6).toUpperCase());
        }
        const myID = localStorage.getItem('m1y_user_id');

        onSnapshot(doc(db, "m1y_vips", myID), (d) => {
            if (d.exists()) localStorage.setItem('m1y_premium', 'true');
        });

        // Elanların yüklənməsi
        const jobGrid = document.getElementById('jobGrid');
        const qJobs = query(collection(db, "m1y_jobs"), orderBy("createdAt", "desc"));

        onSnapshot(qJobs, (snapshot) => {
            if(!jobGrid) return;
            jobGrid.innerHTML = "";
            snapshot.forEach((d) => {
                const job = d.data();
                jobGrid.innerHTML += `
                    <div class="bg-zinc-900/50 backdrop-blur-xl rounded-[2rem] p-6 border border-white/5 hover:border-cyan-500/50 transition-all duration-500 shadow-2xl group relative overflow-hidden">
                        <div class="flex justify-between items-start mb-4 relative z-10">
                            <span class="px-3 py-1 bg-cyan-500/10 text-cyan-400 text-[10px] font-bold uppercase rounded-lg border border-cyan-500/20">${job.category}</span>
                            <span class="text-green-400 font-black text-xl tracking-tighter">${job.price} AZN</span>
                        </div>
                        <h3 class="text-white font-bold text-xl mb-2 group-hover:text-cyan-400 transition">${job.title}</h3>
                        <p class="text-zinc-400 text-sm mb-6 line-clamp-2 font-light">${job.description}</p>
                        <div class="flex items-center justify-between border-t border-white/5 pt-5 relative z-10">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-tr from-cyan-600 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">${job.userName ? job.userName.charAt(0) : 'U'}</div>
                                <div><p class="text-xs font-bold text-zinc-200">${job.userName}</p></div>
                            </div>
                            <a href="https://wa.me/${job.phone}" target="_blank" class="p-3 bg-white text-black rounded-xl hover:bg-cyan-500 hover:text-white transition shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326z"/></svg>
                            </a>
                        </div>
                    </div>`;
            });
        });

        // GLOBAL CHAT FUNKSİYALARI
        const chatRef = ref(rdb, 'm1y_global_chat');
        window.sendChatMessage = async function() {
            const msgInput = document.getElementById('chatInput');
            const nameInput = document.getElementById('chatUser');
            const msg = msgInput.value.trim();
            const user = nameInput.value.trim() || "Anonim";
            if(msg !== "") {
                try {
                    await push(chatRef, { username: user, message: msg, timestamp: serverTimestamp() });
                    msgInput.value = "";
                } catch (e) { console.error(e); }
            }
        }

        onValue(rQuery(chatRef, limitToLast(30)), (snapshot) => {
            const chatBox = document.getElementById('chatMessages');
            if(!chatBox) return;
            chatBox.innerHTML = "";
            snapshot.forEach((child) => {
                const data = child.val();
                chatBox.innerHTML += `<div class="mb-2 border-l-2 border-cyan-500/30 pl-3 py-1"><span class="text-cyan-400 font-bold text-[11px]">[${data.username}]</span><span class="text-zinc-300 text-[12px] block font-mono">${data.message}</span></div>`;
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        // ADMİN SİSTEMİ
        window.openAdmin = async function() {
            const enteredPass = prompt("Admin Şifrəsi:");
            if (!enteredPass) return;
            try {
                const adminSnap = await getDoc(doc(db, "m1y_settings", "admin_config"));
                if (adminSnap.exists() && enteredPass === adminSnap.data().pass) {
                    document.getElementById('adminPanel').style.display = 'flex';
                    loadAdminData();
                } else { alert("Şifrə səhvdir!"); }
            } catch (e) { alert("Xəta: " + e.message); }
        }

        function loadAdminData() {
            onSnapshot(qJobs, (snap) => {
                const list = document.getElementById('adminList');
                list.innerHTML = "<h4 class='text-[10px] text-cyan-500 font-black mb-2 uppercase border-b border-white/10 pb-1'>Elanlar</h4>";
                snap.forEach(d => {
                    list.innerHTML += `<div class="flex justify-between items-center bg-black/50 p-3 rounded-xl mb-2 border border-white/5"><span class="text-[10px] text-white truncate w-32">${d.data().title}</span><button onclick="deleteJob('${d.id}')" class="text-red-500 font-bold text-[10px]">SİL</button></div>`;
                });
            });
            onValue(rQuery(chatRef, limitToLast(20)), (snap) => {
                const chatList = document.getElementById('adminChatList');
                chatList.innerHTML = "<h4 class='text-[10px] text-purple-500 font-black mt-4 mb-2 uppercase border-b border-white/10 pb-1'>Chat Moderasiyası</h4>";
                snap.forEach(child => {
                    chatList.innerHTML += `<div class="flex justify-between items-center bg-black/50 p-3 rounded-xl mb-1 border border-white/5 flex flex-col items-start"><span class="text-[8px] text-purple-400 font-bold">${child.val().username}</span><span class="text-[9px] text-zinc-400 truncate w-32">${child.val().message}</span><button onclick="deleteMessage('${child.key}')" class="text-red-500 font-bold text-[9px] mt-1">SİL</button></div>`;
                });
            });
        }

        window.deleteMessage = async function(id) { if(confirm("Mesaj silinsin?")) await remove(ref(rdb, `m1y_global_chat/${id}`)); }
        window.deleteJob = async function(id) { if(confirm("Elan silinsin?")) await deleteDoc(doc(db, "m1y_jobs", id)); }
        
        window.makeVIP = async function() {
            const vipID = document.getElementById('vipIDInput').value.trim();
            if(vipID) { await setDoc(doc(db, "m1y_vips", vipID), { active: true }); alert("İstifadəçi VİP edildi!"); }
        }

        window.submitM1Y = async function() {
            const lastDate = localStorage.getItem('lastPost');
            const today = new Date().toLocaleDateString();
            if (localStorage.getItem('m1y_premium') !== 'true' && lastDate === today) { document.getElementById('limitError').classList.remove('hidden'); return; }
            const data = { userName: document.getElementById('mName').value, title: document.getElementById('mTitle').value, price: document.getElementById('mPrice').value, category: document.getElementById('mCat').value, phone: document.getElementById('mPhone').value, description: document.getElementById('mDesc').value, createdAt: new Date() };
            await addDoc(collection(db, "m1y_jobs"), data);
            localStorage.setItem('lastPost', today);
            location.reload();
        }

        let clickCount = 0;
        window.secretAdminTrigger = function() {
            clickCount++;
            if(clickCount === 3) { openAdmin(); clickCount = 0; }
            setTimeout(() => { clickCount = 0; }, 2000);
        }

        window.addEventListener('DOMContentLoaded', () => {
             document.getElementById('displayMyID').innerText = myID;
        });
    </script>

    <style>
        body { background: #050505; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }
        .cyber-bg { background: radial-gradient(circle at top right, #0a0a20, #050505); position: fixed; inset: 0; z-index: -1; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; backdrop-filter: blur(15px); align-items: center; justify-content: center; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #151515; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="cyber-bg"></div>

    <nav class="border-b border-white/5 py-6 bg-black/50 backdrop-blur-xl sticky top-0 z-50">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <h1 class="text-2xl font-black italic tracking-tighter text-cyan-500">M1Y</h1>
            <button onclick="document.getElementById('jobModal').style.display='flex'" class="bg-white text-black px-6 py-2 rounded-xl font-bold text-[10px] uppercase tracking-widest hover:bg-cyan-500 transition">Elan Paylaş</button>
        </div>
    </nav>

    <section class="container mx-auto px-6 py-12">
        <div class="max-w-xl mx-auto mb-12"><input type="text" id="searchInp" onkeyup="search()" placeholder="Xidmət axtar..." class="w-full p-5 bg-zinc-900 rounded-2xl border border-white/5 outline-none focus:border-cyan-500 transition"></div>
        <div id="jobGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
    </section>

    <section class="max-w-2xl mx-auto px-6 mb-20">
        <div class="bg-zinc-900/50 border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl">
            <div id="chatMessages" class="h-80 p-6 overflow-y-auto"></div>
            <div class="p-4 bg-black/40 flex gap-2 border-t border-white/5">
                <input id="chatUser" type="text" placeholder="Ad" class="w-24 bg-zinc-800 p-3 rounded-xl border border-white/5 text-[10px] outline-none">
                <input id="chatInput" type="text" placeholder="Mesaj yazın..." class="flex-1 bg-zinc-800 p-3 rounded-xl border border-white/5 text-[10px] outline-none">
                <button onclick="sendChatMessage()" class="bg-cyan-600 px-6 rounded-xl text-[10px] font-bold uppercase tracking-widest">Göndər</button>
            </div>
        </div>
    </section>

    <div id="adminPanel" class="modal">
        <div class="bg-zinc-900 p-8 rounded-[2.5rem] w-full max-w-md border border-white/10 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-cyan-400 font-black uppercase text-xs">Admin Terminal</h2>
                <button onclick="document.getElementById('adminPanel').style.display='none'" class="text-zinc-500">✕</button>
            </div>
            <div class="mb-6 bg-black/30 p-4 rounded-2xl border border-white/5">
                <input type="text" id="vipIDInput" placeholder="Müştəri ID" class="w-full p-3 bg-black/50 rounded-xl border border-white/5 text-[10px] mb-2 outline-none">
                <button onclick="makeVIP()" class="w-full bg-cyan-500 text-black py-2 rounded-xl text-[10px] font-bold uppercase">VİP AKTİV ET</button>
            </div>
            <div class="max-h-72 overflow-y-auto">
                <div id="adminList"></div>
                <div id="adminChatList"></div>
            </div>
        </div>
    </div>

    <div id="jobModal" class="modal">
        <div class="bg-zinc-900 p-8 rounded-[2.5rem] w-full max-w-md border border-white/10">
            <h2 class="text-xl font-black mb-6 text-cyan-500 italic uppercase">Yeni Elan</h2>
            <div id="limitError" class="hidden mb-4 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-[10px] text-red-400 font-bold uppercase">Limit dolub! VİP olun.</div>
            <div class="space-y-3">
                <input type="text" id="mName" placeholder="Adınız" class="w-full p-3 bg-black/40 rounded-xl border border-white/5 text-sm outline-none">
                <input type="text" id="mTitle" placeholder="İş başlığı" class="w-full p-3 bg-black/40 rounded-xl border border-white/5 text-sm outline-none">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="mPrice" placeholder="Qiymət (AZN)" class="p-3 bg-black/40 rounded-xl border border-white/5 text-sm outline-none">
                    <select id="mCat" class="bg-black/40 rounded-xl border border-white/5 text-sm text-zinc-400 outline-none"><option>Dizayn</option><option>Kodlaşdırma</option><option>SMM</option><option>Video Montaj</option></select>
                </div>
                <input type="text" id="mPhone" placeholder="WhatsApp (994...)" class="w-full p-3 bg-black/40 rounded-xl border border-white/5 text-sm outline-none">
                <textarea id="mDesc" placeholder="İş haqqında..." class="w-full p-3 bg-black/40 rounded-xl border border-white/5 h-20 text-sm outline-none"></textarea>
                <button onclick="submitM1Y()" class="w-full py-4 bg-cyan-600 rounded-xl font-black uppercase text-[10px] tracking-widest">Paylaş</button>
                <button onclick="document.getElementById('jobModal').style.display='none'" class="w-full text-zinc-500 text-[10px] mt-2 uppercase tracking-tighter">Ləğv et</button>
                <p class="text-[9px] text-zinc-700 text-center mt-4 uppercase">SİZİN ID: <span id="displayMyID"></span></p>
            </div>
        </div>
    </div>

    <footer class="py-10 text-center text-zinc-800 text-[10px] tracking-widest font-black">
        <span onclick="secretAdminTrigger()" class="cursor-pointer hover:text-zinc-600 transition uppercase">© 2026 M1Y PLATFORM</span>
    </footer>

    <script>
        function search() {
            let v = document.getElementById('searchInp').value.toLowerCase();
            document.querySelectorAll('#jobGrid > div').forEach(c => c.style.display = c.innerText.toLowerCase().includes(v) ? "" : "none");
        }
    </script>
</body>
</html>
